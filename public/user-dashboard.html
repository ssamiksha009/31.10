<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Apollo Tyres</title>
    <link rel="stylesheet" href="/css/user-dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-tire"></i>
                <h2>Apollo Tyres</h2>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="active">
                    <a href="user-dashboard.html">
                        <i class="fas fa-house"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="index.html">
                        <i class="fas fa-plus-circle"></i>
                        <span>New Project</span>
                    </a>
                </li>
                <li>
                    <a href="my-projects.html">
                        <i class="fas fa-folder-open"></i>
                        <span>My Projects</span>
                    </a>
                </li>
                <li>
                    <a href="activity-log.html">
                        <i class="fas fa-list-check"></i>
                        <span>Activity Log</span>
                    </a>
                </li>
                <li>
                    <a href="history.html">
                    <i class="fas fa-history"></i>
                    <span>Project History</span>
                    </a>
                </li>
                <li>
                    <a href="\components\help.pdf" target="_blank">
                        <i class="fas fa-circle-question"></i>
                        <span>Help</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <p class="user-name" id="userName">Loading...</p>
                    <p class="user-role" id="userRole">User</p>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Navigation Bar -->
        <header class="top-bar">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search projects, logs, activities..." id="searchInput">
            </div>
            <div class="top-bar-actions">
                <button class="refresh-btn" id="refreshDashboardBtn" title="Refresh Dashboard">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <div class="user-menu">
                    <span id="topBarUserName">Loading...</span>
                    <div class="user-avatar-small">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                <button class="hamburger-menu-btn" id="hamburgerMenuBtn" title="User Details">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        <!-- User Details Panel -->
        <div class="user-details-panel" id="userDetailsPanel">
            <div class="user-details-header">
                <h3><i class="fas fa-user-circle"></i> User Information</h3>
                <button class="close-panel-btn" id="closePanelBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="user-details-body" id="userDetailsBody">
                <div class="loader">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <p style="text-align: center; color: var(--text-secondary);">Loading user details...</p>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-container">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <div class="welcome-content">
                    <h1>Welcome back, <span id="welcomeUserName">User</span>! 👋</h1>
                    <p>Here's what's happening with your projects today.</p>
                </div>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="window.location.href='index.html'">
                        <i class="fas fa-plus"></i> New Project
                    </button>
                    <button class="btn btn-secondary" onclick="window.location.href='my-projects.html'">
                        <i class="fas fa-folder"></i> View All Projects
                    </button>
                </div>
            </section>

            <!-- Statistics Cards -->
            <section class="stats-grid">
                <div class="stat-card stat-card-primary">
                    <div class="stat-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Total Projects</p>
                        <h3 class="stat-value" id="totalProjects">0</h3>
                        <p class="stat-change positive" id="totalProjectsChange">
                            <i class="fas fa-minus"></i> Loading...
                        </p>
                    </div>
                </div>

                <div class="stat-card stat-card-success">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Completed</p>
                        <h3 class="stat-value" id="completedProjects">0</h3>
                        <p class="stat-change positive" id="completedProjectsChange">
                            <i class="fas fa-minus"></i> Loading...
                        </p>
                    </div>
                </div>

                <div class="stat-card stat-card-warning">
                    <div class="stat-icon">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">In Progress</p>
                        <h3 class="stat-value" id="inProgressProjects">0</h3>
                        <p class="stat-change neutral" id="inProgressProjectsChange">
                            <i class="fas fa-minus"></i> Loading...
                        </p>
                    </div>
                </div>

                <div class="stat-card stat-card-info">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Not Started</p>
                        <h3 class="stat-value" id="notStartedProjects">0</h3>
                        <p class="stat-change negative" id="notStartedProjectsChange">
                            <i class="fas fa-minus"></i> Loading...
                        </p>
                    </div>
                </div>
            </section>

           <!-- NEW SECTION: 3-Feature Row - Protocols, Visualization Chart, Activity Stats, Recent Projects -->
<section class="four-feature-section">
    
    <!-- 1️⃣ Protocol Distribution Chart (280px) -->
    <div class="card protocol-distribution-card">
        <div class="card-header">
            <h2 style="font-size: 15px;"><i class="fas fa-chart-pie"></i> Protocols</h2>
            <div class="card-actions">
                <button class="btn-icon" onclick="refreshProtocolDistribution()" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="protocol-chart-wrapper">
                <canvas id="protocolDistributionChart"></canvas>
            </div>
            <div class="protocol-legend-list" id="protocolLegendList">
                <!-- Dynamic protocol legend -->
            </div>
        </div>
    </div>

    <!-- 2️⃣ Department Distribution Chart (PCR & TBR) -->
<div class="card status-trend-card">
    <div class="card-header">
        <h2 style="font-size: 15px;"><i class="fas fa-building"></i> Departments</h2>
        <div class="card-actions">
            <button class="btn-icon" onclick="refreshDepartmentTrend()" title="Refresh">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="status-trend-chart-wrapper">
            <canvas id="statusTrendChart"></canvas>
        </div>
        <!-- Department Stats Summary Below Chart -->
        <div class="trend-stats-summary">
            <div class="trend-stat-item">
                <div class="trend-stat-icon" style="background: rgba(99, 102, 241, 0.1); color: var(--primary-color);">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="trend-stat-text">
                    <span class="trend-stat-value" id="trendPCR">0</span>
                    <span class="trend-stat-label">PCR</span>
                </div>
            </div>
            <div class="trend-stat-item">
                <div class="trend-stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success-color);">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="trend-stat-text">
                    <span class="trend-stat-value" id="trendTBR">0</span>
                    <span class="trend-stat-label">TBR</span>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- 3️⃣ Advanced Activity Statistics -->
<div class="card activity-stats-card">
    <div class="card-header">
        <h2 style="font-size: 15px;"><i class="fas fa-chart-bar"></i> Activity Stats</h2>
        <div class="card-actions">
            <button class="btn-icon" onclick="refreshActivityStats()" title="Refresh">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <!-- Stats Summary Bar -->
        <div class="stats-summary-bar">
            <div class="summary-item">
                <i class="fas fa-calendar-week"></i>
                <span id="last7DaysCount">0</span> in last 7 days
            </div>
            <div class="summary-item">
                <i class="fas fa-check-double"></i>
                <span id="weekCompletedCount">0</span> completed this week
            </div>
            <div class="summary-item">
                <i class="fas fa-clock"></i>
                Last: <span id="lastActivityTime">-</span>
            </div>
        </div>

        <!-- Advanced Activity Metrics -->
        <div class="activity-metrics-grid">
            <div class="metric-item">
                <div class="metric-icon" style="background: rgba(59, 130, 246, 0.1); color: var(--info-color);">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="avgCompletionTime">0</div>
                    <div class="metric-label">Avg. Days</div>
                </div>
            </div>

            <div class="metric-item">
                <div class="metric-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success-color);">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="fastestProject">0</div>
                    <div class="metric-label">Fastest</div>
                </div>
            </div>

            <div class="metric-item">
                <div class="metric-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning-color);">
                    <i class="fas fa-turtle"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="slowestProject">0</div>
                    <div class="metric-label">Slowest</div>
                </div>
            </div>

            <div class="metric-item">
                <div class="metric-icon" style="background: rgba(139, 92, 246, 0.1); color: var(--secondary-color);">
                    <i class="fas fa-layer-group"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="mostUsedProtocol">-</div>
                    <div class="metric-label">Top Protocol</div>
                </div>
            </div>

            <div class="metric-item metric-item-wide">
                <div class="metric-icon" style="background: rgba(99, 102, 241, 0.1); color: var(--primary-color);">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="protocolSuccessRate">0%</div>
                    <div class="metric-label">Success Rate</div>
                </div>
            </div>
        </div>
    </div>
</div>

</section>

            <!-- Replace the existing Recent Projects card with this enhanced version -->
<div class="card recent-projects-card">
    <div class="card-header">
        <h2><i class="fas fa-folder-open"></i> Recent Projects (Last 5)</h2>
        <div class="card-actions">
            <!-- Add this new toggle button -->
            <button class="btn-icon" id="viewToggleBtn" title="Toggle View">
                <i class="fas fa-grid-2"></i>
            </button>
            <button class="btn-icon" onclick="refreshRecentProjects()" title="Refresh">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="btn-text" onclick="window.location.href='my-projects.html'">
                View All <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="projects-list scrollable-menu" id="recentProjectsList">
            <!-- Dynamic projects will be inserted here -->
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading projects...</p>
            </div>
        </div>
    </div>
</div>
            </section>

            <!-- User Statistics -->
            <section class="user-stats-section">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-chart"></i> Your Statistics</h2>
                    </div>
                    <div class="card-body">
                        <div class="user-stats-grid">
                            <div class="user-stat-item">
                                <i class="fas fa-calendar-check"></i>
                                <div>
                                    <p class="stat-number" id="userTotalProjects">0</p>
                                    <p class="stat-desc">Projects Created</p>
                                </div>
                            </div>
                            <div class="user-stat-item">
                                <i class="fas fa-clock"></i>
                                <div>
                                    <p class="stat-number" id="userLastLogin">-</p>
                                    <p class="stat-desc">Last Login</p>
                                </div>
                            </div>
                            <div class="user-stat-item">
                                <i class="fas fa-calendar-plus"></i>
                                <div>
                                    <p class="stat-number" id="userJoinDate">-</p>
                                    <p class="stat-desc">Member Since</p>
                                </div>
                            </div>
                            <div class="user-stat-item">
                                <i class="fas fa-award"></i>
                                <div>
                                    <p class="stat-number" id="userCompletionRate">0%</p>
                                    <p class="stat-desc">Completion Rate</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="/js/user-dashboard.js"></script>
</body>
</html>